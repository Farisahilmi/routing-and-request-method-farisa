<!DOCTYPE html>
<html>
<head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }
        .product-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .product-image {
            width: 100%;
            height: 200px;
            background: #f5f5f5;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            font-size: 14px;
            color: #666;
        }
        .product-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        .product-price {
            font-size: 20px;
            font-weight: bold;
            color: #2c5aa0;
            margin-bottom: 10px;
        }
        .product-category {
            display: inline-block;
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }
        .product-stock {
            color: #28a745;
            font-weight: bold;
        }
        .out-of-stock {
            color: #dc3545;
        }
        .view-details {
            display: inline-block;
            background: #007bff;
            color: white;
            padding: 8px 16px;
            text-decoration: none;
            border-radius: 4px;
            margin-top: 10px;
        }
        .view-details:hover {
            background: #0056b3;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        /* Currency/Language Switcher */
        .settings-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .currency-switcher, .language-switcher {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .currency-btn, .language-btn {
            padding: 8px 16px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .currency-btn.active, .language-btn.active {
            background: #2c5aa0;
            color: white;
            border-color: #2c5aa0;
        }
        
        .currency-btn:hover, .language-btn:hover {
            border-color: #2c5aa0;
        }
    </style>
</head>
<body>
    <%- include('nav') %>
    <%- include('notification') %>
    
    <div style="max-width: 1200px; margin: 0 auto; padding: 20px;">
        <!-- Settings Bar -->
        <div class="settings-bar">
            <div class="currency-switcher">
                <span style="font-weight: 600;">
                    <i class="fas fa-money-bill-wave"></i> Currency:
                </span>
                <button class="currency-btn <%= currency === 'IDR' ? 'active' : '' %>" onclick="switchCurrency('IDR')">
                    IDR (Rp)
                </button>
                <button class="currency-btn <%= currency === 'USD' ? 'active' : '' %>" onclick="switchCurrency('USD')">
                    USD ($)
                </button>
            </div>
            
            <div class="language-switcher">
                <span style="font-weight: 600;">
                    <i class="fas fa-globe"></i> Language:
                </span>
                <button class="language-btn <%= language === 'en' ? 'active' : '' %>" onclick="switchLanguage('en')">
                    English
                </button>
                <button class="language-btn <%= language === 'id' ? 'active' : '' %>" onclick="switchLanguage('id')">
                    Indonesia
                </button>
            </div>
        </div>

        <h1>
            <i class="fas fa-boxes"></i> <%= title %>
        </h1>
        
        <% if (products && products.length > 0) { %>
            <div class="products-grid">
                <% products.forEach(function(product) { %>
                    <div class="product-card">
                        <div class="product-image">
                            <% if (product.image && product.image !== '/images/default.jpg') { %>
                                <img src="<%= product.image %>" alt="<%= product.name %>" style="max-width: 100%; max-height: 200px; object-fit: cover;">
                            <% } else { %>
                                <i class="fas fa-image fa-3x" style="color: #ccc;"></i>
                                <br>
                                <%= t ? t.image_coming_soon : 'Image Coming Soon' %>
                            <% } %>
                        </div>
                        
                        <div class="product-name"><%= product.name %></div>
                        
                        <!-- Dynamic Currency Display -->
                        <div class="product-price">
                            <% if (currency === 'IDR') { %>
                                <i class="fas fa-money-bill-wave"></i> Rp <%= (product.price * 15000).toLocaleString('id-ID') %>
                            <% } else { %>
                                <i class="fas fa-dollar-sign"></i> <%= product.price %>
                            <% } %>
                        </div>
                        
                        <span class="product-category">
                            <i class="fas fa-tag"></i> <%= product.category %>
                        </span>
                        
                        <!-- Dynamic Stock Message -->
                        <div class="<%= product.stock > 0 ? 'product-stock' : 'out-of-stock' %>">
                            <% if (product.stock > 0) { %>
                                <i class="fas fa-check-circle"></i> <%= t ? t.in_stock : 'In Stock' %> (<%= product.stock %>)
                            <% } else { %>
                                <i class="fas fa-times-circle"></i> <%= t ? t.out_of_stock : 'Out of Stock' %>
                            <% } %>
                        </div>
                        
                        <p style="color: #666; font-size: 14px; margin: 10px 0;">
                            <i class="fas fa-info-circle"></i> 
                            <%= product.description.length > 100 ? 
                                product.description.substring(0, 100) + '...' : 
                                product.description %>
                        </p>
                        
                        <div class="action-buttons">
                            <a href="/products/<%= product.id %>" class="view-details">
                                <i class="fas fa-eye"></i> <%= t ? t.view_details : 'View Details' %>
                            </a>
                            <a href="/api/products/<%= product.id %>" class="view-details" style="background: #28a745;" target="_blank">
                                <i class="fas fa-code"></i> API
                            </a>
                            <button class="view-details add-to-cart-btn" style="background: #ffc107; color: black; border: none; cursor: pointer;" 
                                    data-product-id="<%= product.id %>">
                                <i class="fas fa-cart-plus"></i> <%= t ? t.add_to_cart : 'Add to Cart' %>
                            </button>
                        </div>
                    </div>
                <% }) %>
            </div>
        <% } else { %>
            <div style="text-align: center; padding: 40px;">
                <i class="fas fa-box-open fa-3x" style="color: #ccc; margin-bottom: 20px;"></i>
                <h3><%= t ? t.no_products : 'No products found' %></h3>
                <p><%= t ? t.no_products_message : 'There are no products available at the moment.' %></p>
            </div>
        <% } %>
    </div>

<script>
    // Add to Cart functionality
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.add-to-cart-btn').forEach(button => {
            button.addEventListener('click', function() {
                const productId = this.getAttribute('data-product-id');
                addToCart(productId);
            });
        });
        
        // Update cart count on page load
        updateCartCount();
    });

    async function addToCart(productId) {
        try {
            const response = await fetch('/cart/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ productId: productId, quantity: 1 })
            });
            
            const result = await response.json();
            if (result.success) {
                showNotification('success', 
                    'Success!', 
                    'Product added to cart!'
                );
                // Update cart count in navbar
                updateCartCount();
            } else {
                showNotification('error', 
                    'Error', 
                    result.message || 'Failed to add product to cart'
                );
            }
        } catch (error) {
            showNotification('error', 
                'Error', 
                'Error adding to cart'
            );
        }
    }

    // Update cart count in navbar
    async function updateCartCount() {
        try {
            const response = await fetch('/cart/count');
            const result = await response.json();
            
            // Update cart counter in navbar
            const cartCounter = document.querySelector('.cart-count');
            if (cartCounter) {
                cartCounter.textContent = result.count;
                // Show/hide badge based on count
                if (result.count > 0) {
                    cartCounter.style.display = 'inline';
                } else {
                    cartCounter.style.display = 'none';
                }
            }
        } catch (error) {
            console.error('Error updating cart count:', error);
        }
    }

    // Currency Switcher
    function switchCurrency(newCurrency) {
        window.location.href = '/products?currency=' + newCurrency;
    }

    // Language Switcher  
    function switchLanguage(newLanguage) {
        window.location.href = '/products?lang=' + newLanguage;
    }
</script>
</body>
</html>