# ğŸ¯ Buy Now Feature - Architecture & Flow Diagram

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FRONTEND (EJS Views)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  products.ejs              checkout.ejs      cart.ejs          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Product List â”‚          â”‚ Checkout Formâ”‚  â”‚ Shopping Cartâ”‚  â”‚
â”‚  â”‚ [âš¡ Buy Now] â”‚â”€â”€â”€â”€â”¬â”€â”€â”€â”€â†’â”‚ Address      â”‚  â”‚ [Items]      â”‚  â”‚
â”‚  â”‚ [Add to Cart]â”‚    â”‚     â”‚ Payment      â”‚  â”‚ [Checkout]   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚     â”‚ Complete Btn â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BACKEND (Express Routes)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  GET /products/:id/buy-now                                     â”‚
â”‚  â”œâ”€ Check authentication                                       â”‚
â”‚  â”œâ”€ Validate product & stock                                   â”‚
â”‚  â”œâ”€ Store buyNowItem in session                                â”‚
â”‚  â””â”€ Redirect â†’ /cart/checkout                                  â”‚
â”‚                                                                 â”‚
â”‚  GET /cart/checkout                                            â”‚
â”‚  â”œâ”€ Detect session.buyNowItem                                  â”‚
â”‚  â”œâ”€ Load addresses & products                                  â”‚
â”‚  â”œâ”€ Render checkout page with isBuyNow flag                    â”‚
â”‚  â””â”€ Show appropriate UI elements                               â”‚
â”‚                                                                 â”‚
â”‚  POST /cart/checkout                                           â”‚
â”‚  â”œâ”€ Detect Buy Now vs Cart items                               â”‚
â”‚  â”œâ”€ 3-PHASE COMMIT:                                            â”‚
â”‚  â”‚  â”œâ”€ PHASE 1: VALIDATE constraints                           â”‚
â”‚  â”‚  â”œâ”€ PHASE 2: PREPARE order object                           â”‚
â”‚  â”‚  â””â”€ PHASE 3: COMMIT to storage                              â”‚
â”‚  â”œâ”€ Clear session.buyNowItem if success                        â”‚
â”‚  â””â”€ Return response with redirectUrl                           â”‚
â”‚                                                                 â”‚
â”‚  GET /cart/checkout/success                                    â”‚
â”‚  â””â”€ Show order confirmation                                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            DATA STORAGE (JSON Files)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  products.json     orders.json      addresses.json             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ id, name    â”‚   â”‚ id, userId   â”‚  â”‚ id, userId     â”‚       â”‚
â”‚  â”‚ price       â”‚   â”‚ items[]      â”‚  â”‚ label, address â”‚       â”‚
â”‚  â”‚ stock    â—„â”€â”€â”¼â”€â”€â”€â”¤ totalAmount  â”‚  â”‚ isDefault      â”‚       â”‚
â”‚  â”‚ image       â”‚   â”‚ status       â”‚  â”‚ phone, city    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ shipping     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚        â–²           â”‚ payment      â”‚                            â”‚
â”‚        â”‚           â”‚ createdAt    â”‚                            â”‚
â”‚   UPDATE STOCK     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚   (on checkout)                                                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Buy Now Flow (Detailed)

```
START
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User on /products page                 â”‚
â”‚ Sees product cards with buttons:       â”‚
â”‚ [View Details] [API]                   â”‚
â”‚ [âš¡ Buy Now]   [ğŸ›’ Add to Cart]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ User clicks "âš¡ Buy Now"
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ buyNow(productId) JavaScript function  â”‚
â”‚ window.location.href =                 â”‚
â”‚ '/products/:id/buy-now'                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
         â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
         â•‘ AUTHENTICATION CHECKâ•‘
         â•šâ•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚
   NO LOGIN            USER LOGGED IN
        â”‚                   â”‚
        â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redirect to:    â”‚  â”‚ GET /products/:id/buy-now    â”‚
â”‚ /users/login    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ?redirect=...   â”‚  â”‚ VALIDATION:                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”œâ”€ Product exists? âœ“         â”‚
        â”‚            â”‚ â”œâ”€ Stock > 0? âœ“              â”‚
        â”‚            â”‚ â””â”€ Continue...               â”‚
        â”‚            â”‚                              â”‚
        â”‚            â”‚ STORE IN SESSION:            â”‚
        â”‚            â”‚ session.buyNowItem = {       â”‚
        â”‚            â”‚   productId,                 â”‚
        â”‚            â”‚   quantity: 1,               â”‚
        â”‚            â”‚   price,                     â”‚
        â”‚            â”‚   name,                      â”‚
        â”‚            â”‚   stock                      â”‚
        â”‚            â”‚ }                            â”‚
        â”‚            â”‚                              â”‚
        â”‚            â”‚ Redirect to /cart/checkout   â”‚
        â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚
        â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚       â”‚
        â–¼       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /cart/checkout                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ LOAD DATA:                             â”‚
â”‚ â”œâ”€ Check session.buyNowItem            â”‚
â”‚ â”œâ”€ Load addresses for user             â”‚
â”‚ â”œâ”€ Load products (for enrichment)      â”‚
â”‚ â””â”€ Calculate total amount              â”‚
â”‚                                        â”‚
â”‚ RENDER CHECKOUT PAGE:                  â”‚
â”‚ â”œâ”€ Set isBuyNow = true                 â”‚
â”‚ â”œâ”€ Show product in order summary       â”‚
â”‚ â”œâ”€ Show "Direct Purchase" badge        â”‚
â”‚ â””â”€ Display checkout form:              â”‚
â”‚    â”œâ”€ Address selection                â”‚
â”‚    â”œâ”€ Payment method dropdown          â”‚
â”‚    â””â”€ "Complete Purchase Now" button   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ User fills form:
                 â”‚ - Selects address
                 â”‚ - Selects payment method
                 â”‚ - Clicks button
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ processCheckout() JavaScript            â”‚
â”‚ POST /cart/checkout                    â”‚
â”‚ with {addressId, paymentMethod}        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘ PHASE 1: VALIDATION             â•‘
    â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    â•‘ â”œâ”€ Check buyNowItem exists      â•‘
    â•‘ â”œâ”€ Fetch product from DB        â•‘
    â•‘ â”œâ”€ Verify stock available       â•‘
    â•‘ â”œâ”€ Validate address             â•‘
    â•‘ â”œâ”€ Validate payment method      â•‘
    â•‘ â””â”€ Calculate total              â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â”¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                   â”‚ All valid?
                   â”œâ”€ NO  â†’ Return error
                   â”œâ”€ YES â†“
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘ PHASE 2: PREPARE                â•‘
    â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    â•‘ â”œâ”€ Generate Order ID (auto-inc) â•‘
    â•‘ â”œâ”€ Create order object:         â•‘
    â•‘ â”‚  {id, userId, items[],        â•‘
    â•‘ â”‚   totalAmount, status,        â•‘
    â•‘ â”‚   shippingAddress, payment,   â•‘
    â•‘ â”‚   createdAt}                  â•‘
    â•‘ â””â”€ Ready for commit             â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â”¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                   â”‚
                   â–¼
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘ PHASE 3: COMMIT                 â•‘
    â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    â•‘ â”œâ”€ Update product.stock -= qty  â•‘
    â•‘ â”œâ”€ Save products.json           â•‘
    â•‘ â”œâ”€ Add order to orders.json     â•‘
    â•‘ â”œâ”€ Clear cache                  â•‘
    â•‘ â”œâ”€ Delete session.buyNowItem    â•‘
    â•‘ â””â”€ Return success response      â•‘
    â•‘                                 â•‘
    â•‘ ERROR? â†’ Rollback stock         â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â”¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                   â”‚
                   â–¼ Success!
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JavaScript redirect triggered          â”‚
â”‚ window.location.href =                 â”‚
â”‚ /cart/checkout/success?order_id=X     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /cart/checkout/success             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… ORDER CONFIRMATION PAGE             â”‚
â”‚ â”œâ”€ Order ID displayed                  â”‚
â”‚ â”œâ”€ Total amount shown                  â”‚
â”‚ â”œâ”€ Estimated delivery info             â”‚
â”‚ â”œâ”€ What's next steps                   â”‚
â”‚ â””â”€ [Continue Shopping] button          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
                END âœ…
```

## Session State Throughout Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stage    â”‚ session.buyNowItem Status                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1        â”‚ NOT SET (on /products page)                        â”‚
â”‚ 2        â”‚ SET when clicking Buy Now                          â”‚
â”‚          â”‚ { productId, quantity, price, name, stock }       â”‚
â”‚ 3        â”‚ AVAILABLE at /cart/checkout (GET)                 â”‚
â”‚ 4        â”‚ USED in POST /cart/checkout (processing)          â”‚
â”‚ 5        â”‚ DELETED after successful checkout                 â”‚
â”‚ 6        â”‚ NOT SET on success page                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Diagram

```
Input Data              Processing               Output Data
â•â•â•â•â•â•â•â•â•              â•â•â•â•â•â•â•â•â•â•               â•â•â•â•â•â•â•â•â•â•â•â•

GET /products/:id/buy-now
  â”‚
  â”œâ”€ productId         â”€â†’ Fetch product    â”€â†’ Session.buyNowItem
  â””â”€ User session          Store data          {productId, qty, price}
                                               â”‚
                                               â–¼
GET /cart/checkout
  â”‚
  â”œâ”€ Session.buyNowItemâ”€â†’ Load from DB    â”€â†’ Checkout HTML
  â”œâ”€ User ID            Enrich data        Items, Addresses
  â””â”€ Addresses              Build form      Form + isBuyNow flag
                                               â”‚
                                               â–¼
POST /cart/checkout
  â”‚
  â”œâ”€ Form data        â”€â†’ 3-Phase Commit   â”€â†’ Order JSON
  â”œâ”€ Session.buyNowItem  Validate/Prepare   {id, userId, items}
  â””â”€ Products             Commit/Rollback    Stock updated
                                               â”‚
                                               â–¼
GET /cart/checkout/success
  â”‚
  â”œâ”€ Order ID          â”€â†’ Load from DB    â”€â†’ Confirmation HTML
  â””â”€ Total Amount          Validate           Order details
```

## Comparison: Buy Now vs Cart Checkout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stage          â”‚ BUY NOW                  â”‚ NORMAL CART          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Start          â”‚ /products                â”‚ /products            â”‚
â”‚ Action         â”‚ Click [âš¡ Buy Now]       â”‚ Click [ğŸ›’ Cart]      â”‚
â”‚                â”‚                          â”‚ Click [Checkout]     â”‚
â”‚ Data Storage   â”‚ session.buyNowItem       â”‚ cart.json            â”‚
â”‚ Login Check    â”‚ In buy-now route         â”‚ In checkout route    â”‚
â”‚ Redirect Path  â”‚ /products/:id/buy-now    â”‚ Direct to /cart      â”‚
â”‚ Checkout Items â”‚ Single product           â”‚ Multiple items       â”‚
â”‚ Address Select â”‚ At checkout              â”‚ At checkout          â”‚
â”‚ Payment Select â”‚ At checkout              â”‚ At checkout          â”‚
â”‚ Create Order   â”‚ Same 3-phase commit      â”‚ Same 3-phase commit  â”‚
â”‚ Clear Storage  â”‚ Delete buyNowItem        â”‚ Clear cart.json      â”‚
â”‚ Quantity       â”‚ Fixed at 1               â”‚ User selected        â”‚
â”‚ Total Effort   â”‚ 2 clicks + form          â”‚ 3 clicks + form      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Buy Now = Fast Track to Checkout**
**Cart = Traditional Shopping Experience**
